# 创建3D图形对象

## 计算机图形学
这里我们需要对计算机图形学作个基本了解。计算机图形学核心目标可以分解为三个基本任务：表示、交互、绘制，MiaokitJS提供了对应的3组能力来完成这3个任务，并隐藏了底层复杂的操作。

### 3D形态表示
用程序语言和数据表示一个几何形态，描述点、线、面、体等对象。我们使用一个三维向量MiaokitJS.Vector3在笛卡尔坐标系中定义一个空间点，2点表示1条线，3点表示一个三角形。  
在JavaScript中使用Float32Array描述几何所有顶点的坐标，Float32Array.length / 3为顶点个数。  
为了使几何形态绘制更加具有真实感，需要添加光照，进行几何形体的表面纹理映射等操作，这需要我们定义更多的几何属性数据，比如顶点的法线数据，顶点的纹理采样UV数据等，方法与定义坐标类似。  
定义了顶点的属性数据，我们还要描述几何形体的面，三维空间中的形体就是用一组的三角形面表示，因此，程序渲染出来的几何体是“空心”的。使用索引数组（Int32Array）表示一组三角形面，索引是对顶点属性的索引，3个索引表示3个顶点顺时针连接形成一个三角形面，Int32Array.length / 3为三角形面个数。  
例如：一个最基本的立方体，由8个顶点坐标，36个索引表示。

### 3D状态交互
上面我们介绍了3D形态的表示方法，表示出来的几何体是静止不动的，但是我们世界中，是处于不停的运动和变化的。因此，我们需要控制几何体的放置位置，控制它的旋转、缩放、控制各个关节的状态以及控制观察者“眼睛”的观察位置和观察角度。这样我们的虚拟世界就活动起来了。

### 3D几何绘制
我们有方法表示一个3D世界，并让它运动了起来，然后，我们需要将它呈现到浏览器的2D画布上，同时需要使成像效果更加接近真实。当下主流的图形绘制方法是基于光栅化的，这部分细节不在此过多描述。  
为了增加真实感，我们需要设置几何的光照材质，设置表面贴图，添加光照等参数。

## 创建3D图形对象

### 定义顶点坐标数组
```
let GetPosition = function() {
    return new Float32Array([
        // 顶部2个三角形的顶点坐标
        -1.0, -1.0, -1.0, 1.0, -1.0, 1.0, -1.0, -1.0, 1.0,
        -1.0, -1.0, -1.0, 1.0, -1.0, -1.0, 1.0, -1.0, 1.0,
        // 顶部2个三角形的顶点坐标
        -1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
        -1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0,
        // 正面2个三角形的顶点坐标
        -1.0, -1.0, -1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0,
        -1.0, -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, -1.0, -1.0,
        // 右侧2个三角形的顶点坐标
        1.0, -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0,
        1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0,
        // 背面2个三角形的顶点坐标
        1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0,
        1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, 1.0,
        // 左侧2个三角形的顶点坐标
        -1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0, 1.0, -1.0,
        -1.0, -1.0, 1.0, -1.0, 1.0, -1.0, -1.0, -1.0, -1.0,
    ]);
}
```

### 定义顶点法线数组
```
let GetNormal = function() {
    return new Float32Array([
        // 顶部2个三角形的顶点法线
        0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0,
        0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0,
        // 顶部2个三角形的顶点法线
        0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0,
        0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0,
        // 正面2个三角形的顶点法线
        0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0,
        0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0,
        // 右侧2个三角形的顶点法线
        1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0,
        1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0,
        // 背面2个三角形的顶点法线
        0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0,
        0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0,
        // 左侧2个三角形的顶点法线
        -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0,
        -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0,
    ]);
}
```

### 定义顶点UV数组
```
let GetUV = function() {
    return new Float32Array([
        // 顶部2个三角形的顶点UV
        0.0, 0.0, 0.0, 1.0, 1.0, 1.0,
        0.0, 0.0, 1.0, 1.0, 1.0, 0.0,
        // 顶部2个三角形的顶点UV
        0.0, 0.0, 0.0, 1.0, 1.0, 1.0,
        0.0, 0.0, 1.0, 1.0, 1.0, 0.0,
        // 正面2个三角形的顶点UV
        0.0, 0.0, 0.0, 1.0, 1.0, 1.0,
        0.0, 0.0, 1.0, 1.0, 1.0, 0.0,
        // 右侧2个三角形的顶点UV
        0.0, 0.0, 0.0, 1.0, 1.0, 1.0,
        0.0, 0.0, 1.0, 1.0, 1.0, 0.0,
        // 背面2个三角形的顶点UV
        0.0, 0.0, 0.0, 1.0, 1.0, 1.0,
        0.0, 0.0, 1.0, 1.0, 1.0, 0.0,
        // 左侧2个三角形的顶点UV
        0.0, 0.0, 0.0, 1.0, 1.0, 1.0,
        0.0, 0.0, 1.0, 1.0, 1.0, 0.0,
    ]);
}
```

### 定义三角形索引数组
```
let GetIndex = function() {
    let aIndex = new Int32Array(36);

    for (let i = 0; i < 36; i++) {
        aIndex[i] = i;
    }

    return aIndex;
}
```

### 创建网格表面贴图
```
let CreateTexture = function() {
    let pTexture = MiaokitJS.CreateTexture2D();
    pTexture.LoadImage("texture.png");

    return pTexture;
}
```

### 创建网格光照材质
```
let CreateMaterial = function() {
    let pMaterial = MiaokitJS.CreateMaterial();
    pMaterial.mainTexture = CreateTexture();

    return pMaterial;
}
```

### 创建网格组件
```
let CreateMesh = function() {
    let pMesh = MiaokitJS.CreateMesh();
    pMesh.position = GetPosition();
    pMesh.normal = GetNormal();
    pMesh.uv = GetUV();
    pMesh.SetIndices(0, GetIndex());
    pMesh.SetMaterial(0, CreateMaterial());
    pMesh.Apply();
    
    return pMesh;
}
```

### 创建3D图形对象
```
let CreateGameObject = function() {
    let pObject = MiaokitJS.CreateGameObject();
    pObject.transform.position = new MiaokitJS.Vector3(0.0, 1.0, 0.0);
    pObject.mesh = CreateMesh();

    return pMaterial;
}
```
[在线运行完整样例]()